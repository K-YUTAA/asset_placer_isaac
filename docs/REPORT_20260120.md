# 作業報告書（2026-01-20）

## 概要
壁・窓まわりの安定化と座標系の左右反転問題の解消を中心に、プロンプト・実装・ドキュメントを整備しました。併せて、Isaac Simのレイアウト自動復元の仕組みを拡張側に追加しました。

## 実際にやったこと
### 1. 窓ガラスマテリアル接続エラー修正
- `UsdShade` の `ConnectToSource` を正しい型で接続するよう修正
- ガラスマテリアル生成/バインド失敗時でも壁生成を止めないガードを追加

### 2. 左右座標系の整合
- Step1/Step2プロンプトを **右=+X / 左=-X** に統一
- `rotationZ` の左右定義を合わせて修正
- JSON生成ルールに **「右側はX>0」** を明示
- デフォルトプロンプト（`core/constants.py`）も右=+Xへ統一

### 3. JSONのX反転セーフティ
- Step1解析文に「左=+X」が出た場合のみ、X座標と`rotationZ`を自動反転

### 4. 窓の自動生成抑止
- 画像に明示されていない窓は生成しないルールを `prompt_2.txt` に追加

### 5. 詳細設計書の作成
- `docs/SYSTEM_DESIGN.md` を新規作成
- できること、実装方式、データフロー、テスト中項目を整理

### 6. レイアウト自動復元の追加
- 起動時にQuick Layoutを自動ロードする処理を追加
- 設定項目（`auto_layout_*`）を保存対象に追加

## 変更箇所（主なファイル）
- `procedural/wall_generator.py`
- `core/commands.py`
- `core/constants.py`
- `core/extension_app.py`
- `core/settings.py`
- `inputs_isaac/prompt_1.txt`‘
- `inputs_isaac/prompt_2.txt`
- `source/extensions/my.research.asset_placer_isaac/inputs_isaac/prompt_1.txt`
- `source/extensions/my.research.asset_placer_isaac/inputs_isaac/prompt_2.txt`
- `extension_settings.json.example`
- `docs/SYSTEM_DESIGN.md`

## 補足
- レイアウト自動復元は Quick Save/Quick Load を前提とするため、まずQuick Save（Ctrl+7）が必要
- 画像に窓が無い場合は `windows` を省略するよう明示済み
