# 作業報告書（2026-01-18）

## 概要
USD Search Placer 拡張の運用性・可視性の改善を中心に、AI設定、UI、アセット除外機能を拡充しました。

## 最近やりたかったこと
- AIの詳細設定（Step1/Step2のモデル・推論強度・verbosity・image detail・max tokens）を個別に制御したい
- 回転オフセット操作を実運用向けに改善したい（親Prim参照・一括反映）
- UIの見切れ（Advanced Settings / Approvalボタン）を解消したい
- 画像/プロンプト/寸法のプレビューをIsaac Sim内で見たい
- 使いたくないアセットを除外し、同時に置き換えたい
- ブラックリストをUIから編集したい
- 旧ドキュメントの整合性を直したい

## 実際にやったこと
### 1. AI Advanced Settingsの追加と反映
- Advanced Settingsのポップアップを追加し、設定を保存
- Step1/Step2でモデル・推論強度・verbosity・image detail・max tokensの上書きを反映
- Responses API側も上書きパラメータを尊重
- 既定 `max_output_tokens=16000` に変更

### 2. Asset Orientation Offsetの改善
- 子Primから親Primを辿って参照（asset URL）を取得
- 回転オフセット保存時に同一参照のPrimを一括反映

### 3. UIの見切れ対策
- Advanced Settingsにスクロールを追加しウィンドウサイズを拡大
- Approvalボタンを下部に固定表示

### 4. プレビュー機能
- 選択中の画像・寸法・プロンプトを表示する「Selected File Preview」ウィンドウを追加
- 画像は `ByteImageProvider` で表示

### 5. アセットブラックリスト機能
- 「Blacklist & Replace」でその場置き換え
- ブラックリストを検索から除外
- メタデータ保存で置き換えに必要な情報を保持
- 「Blacklisted Assets」ウィンドウで削除・全消去・件数表示

### 6. ドキュメント整合
- `backend.py` 前提の記述を `backend/ai_processing.py` に更新
- `KNOWN_ISSUES` を現状に合わせて整理

## 変更箇所（主なファイル）
- `core/extension_app.py`
- `core/ui.py`
- `core/handlers.py`
- `core/commands.py`
- `core/state.py`
- `core/settings.py`
- `backend/ai_processing.py`
- `extension_settings.json.example`
- `docs/ARCHITECTURE.md`
- `docs/API_REFERENCE.md`
- `docs/KNOWN_ISSUES.md`
- `CLAUDE.md`

## 補足
- 一部のUI破棄はイベント中に呼ぶとクラッシュするため、次フレーム破棄に統一
- ブラックリストは `extension_settings.json` に保存されます
